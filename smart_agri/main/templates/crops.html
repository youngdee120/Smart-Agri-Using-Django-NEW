{% load static %}
{% include "partials/_header_nav.html" %}

<!-- crops.css reference -->
<!-- Put this in your <head> BEFORE your local crops.css -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
/>
<link rel="stylesheet" href="{% static 'css/crops.css' %}" />

<!-- We assume your header and footer are pinned in your main CSS,
     so we give <main> enough top/bottom space. -->
<main style="margin-top: 80px; margin-bottom: 80px; min-height: calc(100vh - 160px);">
  <div class="container my-3 mt-3">
    <h1 class="text-success">Crop Recommendation System <span class="text-success">ðŸŒ±</span></h1>

    <!-- Crop Recommendation Form -->
    <form action="{% url 'crops' %}" method="POST">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-4">
          <label for="Nitrogen">Nitrogen (0 - 200)</label>
          <input type="number" class="form-control" name="Nitrogen" min="0" max="200" step="1" placeholder="e.g. 50" required>
        </div>
        <div class="col-md-4">
          <label for="Phosphorus">Phosphorus (0 - 200)</label>
          <input type="number" class="form-control" name="Phosphorus" min="0" max="200" step="1" placeholder="e.g. 40" required>
        </div>
        <div class="col-md-4">
          <label for="Potassium">Potassium (0 - 200)</label>
          <input type="number" class="form-control" name="Potassium" min="0" max="200" step="1" placeholder="e.g. 30" required>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-4">
          <label for="Temperature">Temperature (Â°C)</label>
          <input type="number" class="form-control" name="Temperature" min="-50" max="60" step="0.1" placeholder="e.g. 25" required>
        </div>
        <div class="col-md-4">
          <label for="Humidity">Humidity (%)</label>
          <input type="number" class="form-control" name="Humidity" min="0" max="100" step="0.1" placeholder="0 - 100" required>
        </div>
        <div class="col-md-4">
          <label for="Ph">pH (0 - 14)</label>
          <input type="number" class="form-control" name="Ph" min="0" max="14" step="0.1" placeholder="e.g. 6.5" required>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-4">
          <label for="Rainfall">Rainfall (mm)</label>
          <input type="number" class="form-control" name="Rainfall" min="0" max="3000" step="1" placeholder="e.g. 500" required>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12 text-center">
          <button type="submit" class="btn btn-primary btn-lg">Get Recommendation</button>
        </div>
      </div>
    </form>

    <!-- Result Card (if any) -->
    {% if result %}
      {% comment %} {# 
        The result variable is expected to contain a sentence.
        We assume the first word is the crop name (e.g. "Coffee")
      #} {% endcomment %}
      <div id="resultCard" class="card bg-dark text-white mt-4" data-crop-static="{% static 'images/crops/' %}">
        <img id="resultImage" src="" class="card-img-top" alt="{{ result }}">
        <div class="card-body">
          <h5 class="card-title">Recommended Crop for Cultivation is:</h5>
          <p class="card-text" id="resultText">{{ result }}</p>
        </div>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function() {
          // Grab the full result text
          var resultText = document.getElementById("resultText").innerText.trim();
          // Extract the crop name as the first word
          var cropName = resultText.split(" ")[0];
          // Get the static base path from the data attribute
          var staticPath = document.getElementById("resultCard").dataset.cropStatic;
          // Build the full image path (assuming image files are named in lowercase, e.g. "coffee.png")
          var imagePath = staticPath + cropName.toLowerCase() + ".png";
          // Update the image src and alt attributes
          document.getElementById("resultImage").src = imagePath;
          document.getElementById("resultImage").alt = cropName;
        });
      </script>
    {% endif %}
  </div>
</main>

{% include "partials/_footer.html" %}
